{% extends 'home.html' %}
{% load static %}
{% load widget_tweaks %}
{% block body %}
<body class="hold-transition sidebar-collapse dark-mode layout-fixed ">
<div class="wrapper">
    <div class="content-wrapper mt-3 mb-5">
        <div class="content">
            <div class="container-fluid">
                <form action="." class="needs-validation" enctype="multipart/form-data" method="POST">
                    <div class="card card-default mt-2 mb-2" id="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas {{icon}}"></i>
                                {{title}}
                            </h3>
                        </div>
                        <div class="card-body">
                            <input type="hidden" name="action" value="{{action}}">
                                {% for field in form.visible_fields %}
                                    <div class="form-floating mb-3">
                                         <label for="{{ field.label }}">{{ field.label }}:</label>
                                        {{field}}
                                    </div>
                                {% endfor %}
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary btn-flat" type="submit">
                                <i class="fas fa-save"></i>
                                Guardar registro
                            </button>
                            <a class="btn btn-danger btn-flat ingresos" href="{{url_link}}">
                                <i class="fas fa-times"></i>
                                Cancelar
                            </a>
                        </div>
                    </div>
                     {% csrf_token %}
                </form>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/myForm.js' %}"></script>
<script>
      {% if form.errors %}
        var errors = '';
        {% for field in form %}
            {% for error in field.errors %}
                errors += '{{error}}\n';
            {% endfor %}
        {% endfor %}
        {% for error in form.non_field_errors %}
            errors += '{{error}}\n\n';
        {% endfor %}
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: errors,
    });
    {% endif %}

    $('form').on('submit', function(e){
        e.preventDefault();
        var parameters = new FormData(this);
        alert_confirm(window.location.pathname,'Notificacion', 'Â¿Estas seguro de registrase en la plataforma?', parameters, function(){
           Swal.fire({
              title: 'Alerta',
              text: 'Registro exitoso',
              icon: 'success',
              timer: 3000,
              onClose: () => {
                location.href = '{{url_link}}'
              }
            });
        });
    });
</script>
</body>
{% endblock %}